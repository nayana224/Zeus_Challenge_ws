# -*- coding: utf-8 -*-

TARGETS = {
 "No1":[
  (1,-677.41,-72.63,73.73,-97.27,-0.07,-179.76,"yellow","+90"),
  (2,-751.36,-72.63,73.35,-97.32,-0.08,-179.64,"yellow","+90"),
  (3,-753.67,-31.11,72.75,-97.51,-0.10,-179.78,"yellow","+45"),
  (4,-687.35,  7.06,72.38,-97.37,-0.10,-179.88,"yellow","+45"),
  (5,-687.29, 49.53,73.32,-97.31,-0.10,-179.90,"yellow","+90"),
  (6,-760.81, 47.37,72.89,-97.41,-0.12,-179.91,"yellow","+90"),
  (7,-687.17,113.00,74.91,-97.39,-0.12,-179.87,"purple","+90"),
  (8,-687.14,137.81,74.57,-97.26,-0.13,-179.87,"blue","+90"),
  (9,-687.02,164.98,74.23,-97.27,-0.16,-179.70,"green","+90"),
  (10,-820.41,217.27,73.76,-97.18,-0.19,-179.80,"red","+45"),
  (11,-787.00,253.01,73.94,-97.39,-0.12, 179.98,"red","+90"),
  (12,-710.85,252.63,74.92,-97.46,-0.21,-179.74,"red","+90"),
  (13,-662.51,252.57,74.37,-97.48,-0.25,-179.63,"red","0"),
 ],
 "ZE":[
  (1,-543.39,-191.73,75.13,-97.65,-0.27,-179.59,"purple","0"),
  (2,-543.32,-116.65,74.92,-97.64,-0.27,-179.50,"purple","0"),
  (3,-495.03,-126.96,74.78,-97.79,-0.32,-179.56,"purple","+45"),
  (4,-440.35,-180.95,77.00,-97.82,-0.30,-179.53,"purple","+45"),
  (5,-392.41,-190.72,76.86,-97.76,-0.33,-179.60,"purple","0"),
  (6,-392.11,-114.59,76.72,-97.63,-0.30,-179.48,"purple","0"),
  (7,-544.62, 80.17,76.61,-97.75,-0.30,-179.53,"blue","0"),
  (8,-544.91,  5.90,76.52,-97.81,-0.36,-179.61,"blue","0"),
  (9,-508.05,-48.69,76.38,-97.80,-0.39,-179.44,"blue","+90"),
  (10,-470.18, 8.48,76.19,-97.89,-0.40,-179.28,"blue","0"),
  (11,-470.39,82.30,76.07,-97.97,-0.47,-179.15,"blue","0"),
  (12,-431.44,-47.10,75.87,-97.92,-0.44,-179.10,"blue","+90"),
  (13,-395.89, 8.08,75.77,-98.03,-0.47,-179.01,"blue","0"),
  (14,-397.37,82.23,76.99,-98.08,-0.49,-178.92,"blue","0"),
 ],
 "US":[
  (1,-522.69,151.74,76.62,-97.90,-0.38,-178.96,"green","+90"),
  (2,-446.26,151.66,76.49,-97.78,-0.38,-178.97,"green","+90"),
  (3,-394.91,181.03,76.34,-97.86,-0.43,-178.87,"green","0"),
  (4,-394.78,256.08,79.36,-97.75,-0.42,-178.86,"green","0"),
  (5,-447.34,276.52,78.98,-97.60,-0.33,-178.94,"green","+90"),
  (6,-522.56,276.42,78.73,-97.60,-0.39,-178.81,"green","+90"),
  (7,-549.36,447.19,79.86,-97.60,-0.31,-178.71,"pink","0"),
  (8,-549.34,372.34,79.48,-97.53,-0.22,-178.78,"pink","0"),
  (9,-520.71,319.77,79.12,-97.43,-0.20,-178.88,"pink","+90"),
  (10,-471.38,345.27,78.72,-97.49,-0.19,-178.83,"pink","0"),
  (11,-474.47,418.96,80.38,-97.52,-0.19,-178.76,"pink","0"),
  (12,-437.82,474.69,82.64,-97.63,-0.30,-178.80,"pink","+90"),
  (13,-400.09,421.27,82.29,-97.44,-0.26,-178.78,"pink","0"),
  (14,-398.69,347.60,80.67,-97.72,-0.57,-178.51,"pink","0"),
 ],
}




# ----- 상태 저장용 변수 -----
used_targets = set()  # 이미 배치한 (섹션, 인덱스) 저장
order = ["No1", "ZE", "US"]  # 탐색 순서


def get_target_pose_by_color(color):
    """
    color를 입력받아 다음 사용 가능한 목표 위치의
    (eval_tcp_pose, delta_angle)을 반환.
    delta_angle은 float으로 반환됨.
    없으면 (None, None) 반환.
    """
    # 색상 정규화 (대/소문자, 공백)
    if color is None:
        return None, None
    q = str(color).strip().lower()
    
    for section in order:
        for t in TARGETS[section]:
            idx = t[0]
            target_color = str(t[7]).strip().lower()
            if target_color == q and (section, idx) not in used_targets:
                used_targets.add((section, idx))
                eval_tcp_pose = (float(t[1]), float(t[2]), float(t[3]),
                                 float(t[4]), float(t[5]), float(t[6]))
                try:
                    delta_angle = float(t[8])
                except:
                    delta_angle = 0.0
                return eval_tcp_pose, delta_angle
    return None, None


# ----- 테스트 -----
if __name__ == "__main__":
    p, a = get_target_pose_by_color("yellow")
    print("yellow 1:", p, a)
    p, a = get_target_pose_by_color("yellow")
    print("yellow 2:", p, a)
    p, a = get_target_pose_by_color("purple")
    print("purple 1:", p, a)
    p, a = get_target_pose_by_color("green")
    print("green:", p, a)
    p, a = get_target_pose_by_color("yellow")
    print("yellow 3 (none):", p, a)