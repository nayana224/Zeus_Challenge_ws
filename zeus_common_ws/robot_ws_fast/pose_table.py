# -*- coding: utf-8 -*-

TARGETS = {
 "No1":[
  (1,-681.22-10,-145.94+20,  145.02, -79.59,  -0.13, 179.99,"yellow","+90"),
  (2,-754.85-10,-145.94+20,  144.76, -79.59,  -0.13, 180.0,"yellow","+90"),
  (3,-754.39-10,-104.35+20,  144.27, -79.59,  -0.13, 180.00,"yellow","+45"),
  (4,-689.84-10, -65.28+20,  144.08, -79.59,  -0.13, 180.00,"yellow","+45"),
  (5,-689.82-10, -24.70+20,  143.89, -79.59,  -0.13, 180.00,"yellow","+90"),
  (6,-763.10-10, -24.70+20,  144.26, -79.59,  -0.13, 180.00,"yellow","+90"),
  (7,-687.49-10,  41.13+20,  143.66, -79.59,  -0.13, 180.00,"purple","+90"),
  (8,-687.49-10,  66.02+20,  143.66, -79.59,  -0.13, 180.00,"blue","+90"),
  (9,-687.49-10,  90.47+1.0+20,  143.66, -79.59,  -0.13, 180.00,"green","+90"), # 초록이
  (10,-820.99-10, 142.84+20, 143.66, -79.59,  -0.13, 180.00,"red","+55"),
  (11,-790.51-10, 179.28+20,  143.41, -79.59,  -0.13, 180.00,"red","+90"),
  (12,-713.92-10, 179.28+20,  143.25, -79.59,  -0.13, 180.00,"red","+90"),
  (13,-663.68-10, 179.27+20,  143.66, -79.59,  -0.13, 180.00,"red","0"),
 ],
 "ZE":[
  (1,-544.80-10,-291.33+20,  145.81, -79.59,  -0.13, 180.00,"purple","0"),
  (2,-545.81-10,-215.08+20,  144.83, -79.59,  -0.13, 180.00,"purple","0"),
  (3,-496.80-10,-226.38+20,  145.28, -79.43,  -0.09, 179.98,"purple","+45"),
  (4,-444.03-10,-279.85+20,  145.78, -79.43,  -0.09, 179.98,"purple","+45"),
  (5,-396.26-10,-292.00+20,  145.34, -79.43,  -0.09, 179.98,"purple","0"),
  (6,-397.55-10,-216.34+20,  144.61, -79.43,  -0.09, 179.98,"purple","0"),
  (7,-547.28-10, -20.45+20,  144.86, -79.43,  -0.09, 179.98,"blue","0"),
  (8,-547.52-10, -96.35+20,  144.83, -79.43,  -0.09, 179.98,"blue","0"),
  (9,-508.95-10,-148.44+20,  144.83, -79.43,  -0.09, 179.97,"blue","+90"),
  (10,-470.93-10, -96.48+20,  144.11, -79.43,  -0.09, 179.97,"blue","0"),
  (11,-472.95-10, -19.10+20,  143.85, -79.43,  -0.09, 179.97,"blue","0"),
  (12,-430.86-10,-147.45+20,  145.02, -79.43,  -0.09, 179.97,"blue","+90"),
  (13,-394.40-10, -93.65+20,  145.30, -79.28,  -0.06,-179.92,"blue","0"),
  (14,-395.47-10, -17.77+20,  143.86, -79.28,  -0.06,-179.92,"blue","0"),
 ],
 "US":[
  (1,-521.41 - 7.25-10,  52.88+ 9.0+10,  143.55, -79.28,  -0.06,-179.92,"green","+90"), # 초록색
  (2,-443.73-10,  52.88+20,  143.42, -79.28,  -0.06,-179.92,"green","+90"),
  (3,-396.52-10,  77.86+20,  142.82, -79.33,  -0.05,-179.95,"green","0"),
  (4,-398.06-10, 158.09+20,  143.01, -79.42,  -0.08,-179.97,"green","0"),
  (5,-445.31-10, 178.37+20,  143.45, -79.42,  -0.08,-179.97,"green","+90"),
  (6,-520.33-10, 178.36+20,  143.23, -79.42,  -0.08,-179.97,"green","+90"),
  (7,-552.55-10, 348.18+20,  143.30, -79.42,  -0.08,-179.97,"pink","0"),
  (8,-548.52-10, 272.74+20,  143.92, -79.42,  -0.08,-179.97,"pink","0"),
  (9,-521.43-10, 223.21+20,  144.13, -79.42,  -0.08,-179.97,"pink","+90"),
  (10,-470.71-10, 251.47+20,  143.89, -79.42,  -0.08,-179.97,"pink","0"),
  (11,-473.04-10, 327.47+20,  143.20, -79.42,  -0.08,-179.97,"pink","0"),
  (12,-436.42-10, 380.21+20,  144.57, -79.42,  -0.08,-179.97,"pink","+90"),
  (13,-397.62-10, 326.40+20,  143.35, -79.42,  -0.08,-179.97,"pink","0"),
  (14,-399.32-10, 245.98+20,  144.32, -79.42,  -0.08,-179.97,"pink","0"),
 ],
}




# ----- 상태 저장용 변수 -----
used_targets = set()  # 이미 배치한 (섹션, 인덱스) 저장
order = ["No1", "ZE", "US"]  # 탐색 순서


def get_target_pose_by_color(color):
    """
    color를 입력받아 다음 사용 가능한 목표 위치의
    (eval_tcp_pose, delta_angle)을 반환.
    delta_angle은 float으로 반환됨.
    없으면 (None, None) 반환.
    """
    # 색상 정규화 (대/소문자, 공백)
    if color is None:
        return None, None
    q = str(color).strip().lower()
    
    for section in order:
        for t in TARGETS[section]:
            idx = t[0]
            target_color = str(t[7]).strip().lower()
            if target_color == q and (section, idx) not in used_targets:
                used_targets.add((section, idx))
                eval_tcp_pose = (float(t[1]), float(t[2]), float(t[3]),
                                 float(t[4]), float(t[5]), float(t[6]))
                try:
                    delta_angle = float(t[8])
                except:
                    delta_angle = 0.0
                return eval_tcp_pose, delta_angle
    return None, None


# ----- 테스트 -----
if __name__ == "__main__":
    p, a = get_target_pose_by_color("yellow")
    print("yellow 1:", p, a)
    p, a = get_target_pose_by_color("yellow")
    print("yellow 2:", p, a)
    p, a = get_target_pose_by_color("purple")
    print("purple 1:", p, a)
    p, a = get_target_pose_by_color("green")
    print("green:", p, a)
    p, a = get_target_pose_by_color("yellow")
    print("yellow 3 (none):", p, a)