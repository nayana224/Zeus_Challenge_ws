# -*- coding: utf-8 -*-

TARGETS = {
 "No1":[
  (1,-681.22,-145.94,  145.02, -79.59,  -0.13, 179.99,"yellow","+90"),
  (2,-754.85,-145.94,  144.76, -79.59,  -0.13, 180.0,"yellow","+90"),
  (3,-754.39,-104.35,  144.27, -79.59,  -0.13, 180.00,"yellow","+45"),
  (4,-689.84, -65.28,  144.08, -79.59,  -0.13, 180.00,"yellow","+45"),
  (5,-689.82, -24.70,  143.89, -79.59,  -0.13, 180.00,"yellow","+90"),
  (6,-763.10, -24.70,  144.26, -79.59,  -0.13, 180.00,"yellow","+90"),
  (7,-687.49,  41.13,  143.66, -79.59,  -0.13, 180.00,"purple","+90"),
  (8,-689.11,  66.02,  144.20, -79.59,  -0.13, 180.00,"blue","+90"),
  (9,-689.09,  90.47,  143.90, -79.59,  -0.13, 180.00,"green","+90"),
  (10,-820.99, 142.84, 143.13, -79.59,  -0.13, 180.00,"red","+45"),
  (11,-790.51, 179.28,  143.41, -79.59,  -0.13, 180.00,"red","+90"),
  (12,-713.92, 179.28,  143.25, -79.59,  -0.13, 180.00,"red","+90"),
  (13,-663.68, 179.27,  143.66, -79.59,  -0.13, 180.00,"red","0"),
 ],
 "ZE":[
  (1,-544.80,-291.33,  145.81, -79.59,  -0.13, 180.00,"purple","0"),
  (2,-545.81,-215.08,  144.83, -79.59,  -0.13, 180.00,"purple","0"),
  (3,-496.80,-226.38,  145.28, -79.43,  -0.09, 179.98,"purple","+45"),
  (4,-444.03,-279.85,  145.78, -79.43,  -0.09, 179.98,"purple","+45"),
  (5,-396.26,-292.00,  145.34, -79.43,  -0.09, 179.98,"purple","0"),
  (6,-397.55,-216.34,  144.61, -79.43,  -0.09, 179.98,"purple","0"),
  (7,-547.28, -20.45,  144.86, -79.43,  -0.09, 179.98,"blue","0"),
  (8,-547.52, -96.35,  144.83, -79.43,  -0.09, 179.98,"blue","0"),
  (9,-508.95,-148.44,  144.83, -79.43,  -0.09, 179.97,"blue","+90"),
  (10,-470.93, -96.48,  144.11, -79.43,  -0.09, 179.97,"blue","0"),
  (11,-472.95, -19.10,  143.85, -79.43,  -0.09, 179.97,"blue","0"),
  (12,-430.86,-147.45,  145.02, -79.43,  -0.09, 179.97,"blue","+90"),
  (13,-394.40, -93.65,  145.30, -79.28,  -0.06,-179.92,"blue","0"),
  (14,-395.47, -17.77,  143.86, -79.28,  -0.06,-179.92,"blue","0"),
 ],
 "US":[
  (1,-521.41,  52.88,  143.55, -79.28,  -0.06,-179.92,"green","+90"),
  (2,-443.73,  52.88,  143.42, -79.28,  -0.06,-179.92,"green","+90"),
  (3,-396.52,  77.86,  142.82, -79.33,  -0.05,-179.95,"green","0"),
  (4,-398.06, 158.09,  143.01, -79.42,  -0.08,-179.97,"green","0"),
  (5,-445.31, 178.37,  143.45, -79.42,  -0.08,-179.97,"green","+90"),
  (6,-520.33, 178.36,  143.23, -79.42,  -0.08,-179.97,"green","+90"),
  (7,-552.55, 348.18,  143.30, -79.42,  -0.08,-179.97,"pink","0"),
  (8,-548.52, 272.74,  143.92, -79.42,  -0.08,-179.97,"pink","0"),
  (9,-521.43, 223.21,  144.13, -79.42,  -0.08,-179.97,"pink","+90"),
  (10,-470.71, 251.47,  143.89, -79.42,  -0.08,-179.97,"pink","0"),
  (11,-473.04, 327.47,  143.20, -79.42,  -0.08,-179.97,"pink","0"),
  (12,-436.42, 380.21,  144.57, -79.42,  -0.08,-179.97,"pink","+90"),
  (13,-397.62, 326.40,  143.35, -79.42,  -0.08,-179.97,"pink","0"),
  (14,-399.32, 245.98,  144.32, -79.42,  -0.08,-179.97,"pink","0"),
 ],
}




# ----- 상태 저장용 변수 -----
used_targets = set()  # 이미 배치한 (섹션, 인덱스) 저장
order = ["No1", "ZE", "US"]  # 탐색 순서


def get_target_pose_by_color(color):
    """
    color를 입력받아 다음 사용 가능한 목표 위치의
    (eval_tcp_pose, delta_angle)을 반환.
    delta_angle은 float으로 반환됨.
    없으면 (None, None) 반환.
    """
    # 색상 정규화 (대/소문자, 공백)
    if color is None:
        return None, None
    q = str(color).strip().lower()
    
    for section in order:
        for t in TARGETS[section]:
            idx = t[0]
            target_color = str(t[7]).strip().lower()
            if target_color == q and (section, idx) not in used_targets:
                used_targets.add((section, idx))
                eval_tcp_pose = (float(t[1]), float(t[2]), float(t[3]),
                                 float(t[4]), float(t[5]), float(t[6]))
                try:
                    delta_angle = float(t[8])
                except:
                    delta_angle = 0.0
                return eval_tcp_pose, delta_angle
    return None, None


# ----- 테스트 -----
if __name__ == "__main__":
    p, a = get_target_pose_by_color("yellow")
    print("yellow 1:", p, a)
    p, a = get_target_pose_by_color("yellow")
    print("yellow 2:", p, a)
    p, a = get_target_pose_by_color("purple")
    print("purple 1:", p, a)
    p, a = get_target_pose_by_color("green")
    print("green:", p, a)
    p, a = get_target_pose_by_color("yellow")
    print("yellow 3 (none):", p, a)